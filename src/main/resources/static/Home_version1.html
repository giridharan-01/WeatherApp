<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Login</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
if(localStorage.getItem("message")==null){
	window.location.replace("/");
}
//console.log("Text: "+localStorage.getItem("message"));

/*var display=JSON.parse(localStorage.getItem("message"));
		console.log("Display :"+display['message']);
	  $("#welcome").html(display['message']);
*/	  
function startTime() {
		
	  var today = new Date();
	  var date_day=today.toDateString();
	  var h = today.getHours();
	  var m = today.getMinutes();
	  var s = today.getSeconds();
	  m = checkTime(m);
	  s = checkTime(s);
	  document.getElementById('date').innerHTML =date_day+"<span style='color:red'> "+h + ":" + m + ":" + s+"</span>";
	  var t = setTimeout(startTime, 1000);
	}
	
	function checkTime(i) {
	  if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
	  return i;
	}

$(document).ready(function(){
$('#b1').click(function() {
    $('#table').css({
    	'visibility': 'visible'
    });
    $('#moreinfobutton').css({
    	'visibility': 'visible'
    });
});

$('#moreinfobutton').click(function() {
    $('#moreinfo').css({
    	'visibility': 'visible'
    });
    $('#moreinfobutton').css({
    	'visibility': 'hidden'
    });
});
});

/*
$(document).ready(function(){
	$('#moreinfobutton').click(function() {
	    $('#moreinfo').css({
	    	'visibility': 'visible'
	    });
	});
	});

*/
var output=null;

function clearLocalStorage(){
	localStorage.removeItem("message");
	console.log("cleared success");
	alert("Logged out successfully");
	window.location.replace("index.html");
}


function getWeatherData(){
	var city=document.getElementById("city").value;
	//console.log(city);
	//$("#cityname").html(city.toUpperCase());
	var url="http://localhost:8888/test/"+city;
	var request = new XMLHttpRequest();
	//var url='http://localhost:8888/test/'+document.getElementById("city");
	//var city=document.getElementById("city");
	//alert(city);
	// Open a new connection, using the GET request on the URL endpoint
	request.open('GET',url , true)
	//console.log(city);

	request.onload = function () {
	  // Begin accessing JSON data here
	  output=JSON.parse(this.response);
	  //console.log("Timezone offset="+output.timezone_offset);
	  //$("#city").val(output.timezone);
	  //console.log("current temp="+output.current.temp);
	  //$("#curdaytime").text(output.current.dt);
		
	  $("#cityname").html(city.toUpperCase()+"<br/> Timezone : "+output.timezone);
	 var daily=output["daily"];	
	
	
	var l=daily.length;
	for(let i=0;i<l;i++){
		var date= new Date( daily[i].dt *1000);
		var h="#h"+i;
		console.log(h);
		$(h).html(date.toDateString());
		
		//var t="<b>Day & Time</b> :"+date.toGMTString()+"<br /><br />";
		var t="<b>Temp-Max:</b> "+daily[i].temp.max+" &#8451 <br />"+"<b>Temp-Min:</b> "+daily[i].temp.min+" &#8451 <br /><br />";
		//t=t+"<b>pressure: </b>"+daily[i].pressure+" hPa<br /><br />";
		var pop=daily[i].pop*100;
		t=t+"<b>Percipitation: </b>"+Math.round(pop)+" %<br /><br />";
		t=t+"<b>Wind Speed: </b>"+daily[i].wind_speed+" metre/sec<br /><br />"+"<b>Humidity</b> : "+daily[i].humidity+" %<br/><br/>";
		//console.log(t);
		var c="#day"+i;
		//console.log(c);
		$(c).html(t);	//max temperature;
	}
	  
	}
	
	

	// Send request
	request.send()
	
}


function getWeatherInfoOfTheDay(){ 		// x refers to the btn id
	var daily=output["daily"];
	console.log("daily");
	var l=daily.length;
	console.log(l);
	for(let i=0;i<l;i++){
		console.log("iteration");
		var sunrise= new Date( daily[i].sunrise *1000);
		var sunset= new Date( daily[i].sunset *1000);
		var t="<b>Sunrise</b> :"+sunrise.toString()+"<br /><br />"+"<b>Sunset</b> :"+sunset.toString()+"<br /><br />";;
		console.log(daily[i].weather[0].description);
		t=t+"<b>Weather Description</b> :"+daily[i].weather[0].description+"<br /><br />";
		t=t+"<b>Dew point</b> :"+daily[i].dew_point+" &#8451<br /><br />"+"<b>Pressure</b> :"+daily[i].pressure+" hPa<br/>";
		t=t+"<h3>AIR QUALITY</h3>"+" <b>UV index </b> :"+daily[i].uvi+"<br/><br/>";
		var rain=0;
		if(daily[i].rain)
			rain=daily[i].rain;
		
		t=t+"<b>Clouds</b> :"+daily[i].clouds+" %<br/><br/>"+"<b>Rain</b> : "+rain+" %<br/><br/>";
		var c="#info"+i;
		console.log(c);
		//console.log(c);
		$(c).html(t);	//max temperature
	} 
	}
	

	

</script>
<style>
th,h1,h3{
text-align: center;
}
table {
  border-collapse: collapse;
}
th{
font-size: 30px;
}
table, th ,td{
  border: 1px solid black;
}

td{
color:#000d1a;
}

.block {
  display: block;
  width: 100%;
  border: none;
  padding: 14px 28px;
  font-size: 16px;
  cursor: pointer;
  text-align: center;
}

.block:hover {
  background-color: #ddd;
  color: black;
}
</style>

</head>

<body onload="startTime()">

	<div>
	<span id="welcome"></span>
		<span style="float: right;">
		<span id="date" style=""></span> 
		<span><input name="submit2" type="submit" id="submit2" value="Logout" style="font-size: 12px;"  onclick="clearLocalStorage()"/> </span>
		</span>
	</div>
<h1 style="font-size:40px;">Weather Forecast Data</h1>
<div id="searchbox" style="text-align: center">
<input type="text" id="city" style="text-align:center;font-size: 18px;width:25%;padding: 5px 0px 5px;" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" value="getWeatherInfo" id="b1" onclick="getWeatherData()" style="font-size: 16px;padding: 5px 4px 5px; background-color:Gray;color:White" /> 
</div>
<br><br>	
<h1 id="cityname"></h1>
<table id="table" style="visibility: hidden;">
	<tr>
		<th id="h0"></th>
		<th id="h1"></th>
		<th id="h2"></th>
		<th id="h3"></th>
		<th id="h4"></th>
		<th id="h5"></th>
		<th id="h6"></th>
	</tr>
	
	<tr>
		<td id="day0" ></td>
		<td id="day1"></td>
		<td id="day2"></td>
		<td id="day3"></td>
		<td id="day4"></td>
		<td id="day5"></td>
		<td id="day6"></td>
		
	</tr>
	
	<tr id="moreinfo" style="visibility: hidden;">
		<td id="info0"></td>
		<td id="info1"></td>
		<td id="info2"></td>
		<td id="info3"></td>
		<td id="info4"></td>
		<td id="info5"></td>
		<td id="info6"></td>
	  </tr>
	
	<!-- 
	<tr >
		<td id="info0"><button onclick="getWeatherInfoOfTheDay(0)">MoreInfo</button></td>
		<td id="info1"><button onclick="getWeatherInfoOfTheDay(1)">MoreInfo</button></td>
		<td id="info2"><button onclick="getWeatherInfoOfTheDay(2)">MoreInfo</button></td>
		<td id="info3"><button onclick="getWeatherInfoOfTheDay(3)">MoreInfo</button></td>
		<td id="info4"><button onclick="getWeatherInfoOfTheDay(4)">MoreInfo</button></td>
		<td id="info5"><button onclick="getWeatherInfoOfTheDay(5)">MoreInfo</button></td>
		<td id="info6"><button onclick="getWeatherInfoOfTheDay(6)">MoreInfo</button></td>
	
	</tr>
	 -->
	
</table><br/><br/>

<button id="moreinfobutton"  style="visibility: hidden;background-color:Black;color:White" onclick="getWeatherInfoOfTheDay()" class="block">MoreInfo</button>
<br/><br/>

<!-- 
	<table id="moreinfo" style="visibility: hidden;">
	<tr>
	<td id="info0"></td>
	<td id="info1"></td>
	<td id="info2"></td>
	<td id="info3"></td>
	<td id="info4"></td>
	<td id="info5"></td>
	<td id="info6"></td>
	</tr>
	</table>
 -->

<script>
if(localStorage.getItem("message")==null){
	window.location.replace("/");
}
var display=JSON.parse(localStorage.getItem("message"));
console.log("Display :"+display['message']);
$("#welcome").html(display['message']);

</script>

</body>

</html>